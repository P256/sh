# 运行的用户,用户组
user  web web;

# 进程数,建议设置为等于CPU总核心数
worker_processes  1;

# 全局错误日志定义类型 <debug|info|notice|warn|error|crit>
error_log  /data/log/web/error.log;
#error_log  /data/log/web/error.log  notice;
#error_log  /data/log/web/error.log  info;

# 进程文件
pid        /tmp/nginx.pid;

# 一个进程打开的最多文件描述符数目
# 理论值应该是最多打开文件数(系统的值ulimit -n)与nginx进程数相除
# 但是nginx分配请求并不均匀,所以建议与ulimit -n的值保持一致.
#worker_rlimit_nofile 65535;

# 工作模式与连接数上限
events {
	# 参考事件模型, use [kqueue|rtsig|epoll|/dev/poll|select|poll]
	# epoll模型是Linux 2.6以上版本内核中的高性能网络I/O模型,如果跑在FreeBSD上面,就用kqueue模型.
	#use epoll;
	# 单个进程最大连接数 <最大连接数=连接数*进程数>
    worker_connections  1024;
}

# 设定http服务器,利用它的反向代理功能还可以提供负载均衡支持
http {
    # 设定mime类型,类型由mime.type文件定义
	include       mime.types;
	
	# 设置编码
    charset utf-8;
	
	# 制定默认MIME类型为二进制字节流
    default_type  application/octet-stream;
	
	# 日志格式,参考URL 
    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';
	
	# 日志存放路径
    #access_log  /data/log/web/access.log  main;
	
	# 开启调用Linux的sendfile(),提供文件传输效率
    sendfile        on;
	
    # 防止网络阻塞
	#tcp_nopush     on;
	
	# 长连接超时时间/单位是秒
    #keepalive_timeout  0;
    keepalive_timeout  65;
	
	# 开启目录列表访问,合适下载服务器,默认关闭
	autoindex on;
	# 关闭详细文件大小统计,让文件大小显示MB,GB单位,默认为b
	autoindex_exact_size on;
	# 开启以服务器本地时区显示文件修改日期
    autoindex_localtime on;
	
	# 隐藏版本信息
    server_tokens off;
	# 服务器名字的hash表大小
	server_names_hash_bucket_size 128;
	
	# 上传文件大小限制
	client_header_buffer_size 32k;
	# 设定请求body缓存
	client_max_body_size 8m;
	# 设定请求header缓存
	large_client_header_buffers 4 64k;
	
	# 开启gzip压缩
    gzip  off;
	# 压缩文件最小大小
	gzip_min_length 1k;
	# 压缩缓冲区
	gzip_buffers 4 16k;
	# 压缩版本 <默认1.1;前端如果是squid2.5请使用1.0>
	gzip_http_version 1.1;
	# 压缩等级
	gzip_comp_level 2;
	# 压缩类型,默认就已经包含text/html
	# 所以下面就不用再写了,写上去也不会有问题,但是会有一个warn.
	gzip_types text/plain application/x-javascript text/css application/xml;
	# 和http头有关系,加个vary头,给代理服务器用的,有的浏览器支持压缩
	# 有的不支持,所以避免浪费不支持的也压缩,所以根据客户端的HTTP头来判断,是否需要压缩
	gzip_vary on;
	# 开启限制IP连接数的时候需要使用
	#limit_zone crawler $binary_remote_addr 10m;
	
	# upstream的负载均衡,weight是权重,可以根据机器配置定义权重
	# weigth参数表示权值,权值越高被分配到的几率越大
	#upstream a.com {
		#server 1.1.1.1:80 weight=3;
		#server 1.1.1.1:80 weight=2;
		#server 1.1.1.1:80 weight=3;
	#}
	
	# 虚拟主机配置文件引入
    include vhost.d/*.conf;
}
